language: python

virtualenv:
  system_site_packages: false

matrix:
  include:
    - env: SIMPHONYENV=~/simphony DEPS=apt-mayavi-deps PLUGINS=simphony-mayavi
      python: 2.7

addons:
  apt:
    packages:
      - python-pip

cache:
  ccache: true
  pip: true
  directories:
    - "$HOME/.ccache"

before_install:
  - ccache -s
  - export PATH=/usr/lib/ccache:${PATH}
  - pip install --upgrade pip

before_install:
  - deactivate
  - sudo apt-get update -qq
  - sudo apt-get install ccache
  - ccache -s
  - export PATH=/usr/lib/ccache:${PATH}
  - sudo make deps $DEPS
  - sudo ln -s ccache /usr/local/bin/mpic++

install:
  - make venv-prepare
  - source ~/simphony/bin/activate
  - make simphony
  - make $PLUGINS
  - pip install -r dev_requirements.txt

script:
  - flake8 .
